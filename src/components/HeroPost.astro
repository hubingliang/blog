---
import { slugifyStr } from "@/utils/slugify";
import type { CollectionEntry } from "astro:content";
import { getPath } from "@/utils/getPath";
import Datetime from "./Datetime.astro";

export interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { data, id, filePath } = post;

const {
  title,
  description,
  pubDatetime,
  modDatetime,
  timezone,
  ogImage,
  tags,
} = data;

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
  class: "text-xl md:text-2xl font-bold text-white drop-shadow-lg line-clamp-2",
};
---

<article
  class="group relative overflow-hidden rounded-2xl bg-gray-900 transition-all duration-300 hover:shadow-2xl"
>
  <!-- 背景图片 -->
  <div class="absolute inset-0">
    {
      ogImage ? (
        <img
          src={typeof ogImage === "string" ? ogImage : ogImage.src}
          alt={title}
          class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
          loading="eager"
        />
      ) : (
        <div class="h-full w-full bg-gradient-to-br from-accent/20 to-accent/40" />
      )
    }
    <!-- 渐变遮罩 -->
    <div
      class="absolute inset-0 bg-gradient-to-r from-black/60 via-black/40 to-black/60"
    >
    </div>
  </div>

  <!-- 内容区域 -->
  <div
    class="relative z-10 flex min-h-[500px] md:min-h-[600px] flex-col justify-end p-8 md:p-12"
  >
    <!-- 毛玻璃背景卡片 -->
    <div
      class="rounded-xl border border-white/20 bg-white/10 p-4 md:p-6 shadow-2xl backdrop-blur-md w-full overflow-hidden"
    >
      <!-- 标签 -->
      <div class="mb-2 flex flex-wrap gap-1">
        {
          tags
            .slice(0, 4)
            .map(tag => (
              <span class="inline-block rounded-full border border-white/30 bg-white/20 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm">
                {tag}
              </span>
            ))
        }
        {
          tags.length > 4 && (
            <span class="inline-block rounded-full border border-white/30 bg-white/20 px-2 py-1 text-xs font-medium text-white backdrop-blur-sm">
              +{tags.length - 4}
            </span>
          )
        }
      </div>

      <!-- 标题 -->
      <a
        href={getPath(id, filePath)}
        class="group-link text-decoration-none mb-2 block focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2 focus-visible:ring-offset-transparent focus-visible:outline-none"
      >
        <h2
          {...headerProps}
          class="group-link-hover:text-accent transition-colors duration-200"
        >
          {title}
        </h2>
      </a>

      <!-- 时间 -->
      <div class="mb-2 text-white/90 text-sm">
        <Datetime {pubDatetime} {modDatetime} {timezone} />
      </div>

      <!-- 描述 -->
      <p
        class="mb-3 line-clamp-2 text-sm leading-relaxed text-white/80"
      >
        {description}
      </p>

      <!-- 阅读更多按钮 -->
      <a
        href={getPath(id, filePath)}
        class="inline-flex items-center rounded-lg border border-white/30 bg-white/20 px-4 py-2 text-sm font-medium text-white backdrop-blur-sm transition-all duration-200 hover:border-white/50 hover:bg-white/30 focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-transparent focus:outline-none"
      >
        <span>Read More</span>
        <svg
          class="ml-1 h-3 w-3"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>
  </div>

  <!-- 新文章徽章 -->
  <div class="absolute top-4 right-4 z-20">
    <div
      class="rounded-full border border-accent/20 bg-accent/90 px-3 py-1 text-xs font-bold text-white shadow-lg backdrop-blur-sm"
    >
      Latest
    </div>
  </div>
</article>

<style>
  .group-link-hover\:text-accent:hover {
    color: var(--color-accent);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
